# Foodgram. «Продуктовый помощник»

![workflow](https://github.com/Kolanser/foodgram-project-react/actions/workflows/main.yml/badge.svg)

### Технологии:

- Python

- Django

- Django Rest Framework API

- Gunicorn

- PostgreSQL

- Docker

- Docker Compose

- GitHub Actions

  

### CI\CD проекта :

- автоматический запуск тестов;

- обновление образа на Docker Hub;

- автоматический деплой на боевой сервер при пуше в главную ветку _main_.

 #### Проект размещен на сервере Yandex.Cloud. Вы можете увидеть его [*здесь*](http://http://fooodgram.sytes.net/).

### _Описание_

Онлайн-сервис Foodgram и API для него . На этом сервисе пользователи смогут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.
#### Главная страница

Содержимое главной страницы — список первых шести рецептов, отсортированных по дате публикации (от новых к старым). Остальные рецепты доступны на следующих страницах: внизу страницы есть пагинация.

#### Страница рецепта

На странице — полное описание рецепта. Для авторизованных пользователей — возможность добавить рецепт в избранное и в список покупок, возможность подписаться на автора рецепта.

#### Страница пользователя

На странице — имя пользователя, все рецепты, опубликованные пользователем и возможность подписаться на пользователя.

#### Подписка на авторов

Подписка на публикации доступна только авторизованному пользователю. Страница подписок доступна только владельцу.

Сценарий поведения пользователя:

1.  Пользователь переходит на страницу другого пользователя или на страницу рецепта и подписывается на публикации автора кликом по кнопке «Подписаться на автора».
2.  Пользователь переходит на страницу «Мои подписки» и просматривает список рецептов, опубликованных теми авторами, на которых он подписался. Сортировка записей — по дате публикации (от новых к старым).
3.  При необходимости пользователь может отказаться от подписки на автора: переходит на страницу автора или на страницу его рецепта и нажимает «Отписаться от автора».

#### Список избранного

Работа со списком избранного доступна только авторизованному пользователю. Список избранного может просматривать только его владелец.

Сценарий поведения пользователя:

1.  Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в избранное».
2.  Пользователь переходит на страницу «Список избранного» и просматривает персональный список избранных рецептов.
3.  При необходимости пользователь может удалить рецепт из избранного.

#### Список покупок

Работа со списком покупок доступна авторизованным пользователям. Список покупок может просматривать только его владелец.

Сценарий поведения пользователя:

1.  Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в покупки».
2.  Пользователь переходит на страницу **Список покупок**, там доступны все добавленные в список рецепты. Пользователь нажимает кнопку **Скачать список** и получает файл с суммированным перечнем и количеством необходимых ингредиентов для всех рецептов, сохранённых в «Списке покупок».
3.  При необходимости пользователь может удалить рецепт из списка покупок. Список покупок скачивается в формате _.txt_
**Уровни доступа пользователей:**

-   Гость (неавторизованный пользователь)
-   Авторизованный пользователь
-   Администратор

#### Что могут делать неавторизованные пользователи

-   Создать аккаунт.
-   Просматривать рецепты на главной.
-   Просматривать отдельные страницы рецептов.
-   Просматривать страницы пользователей.
-   Фильтровать рецепты по тегам.

#### Что могут делать авторизованные пользователи

-   Входить в систему под своим логином и паролем.
-   Выходить из системы (разлогиниваться).
-   Менять свой пароль.
-   Создавать/редактировать/удалять собственные рецепты
-   Просматривать рецепты на главной.
-   Просматривать страницы пользователей.
-   Просматривать отдельные страницы рецептов.
-   Фильтровать рецепты по тегам.
-   Работать с персональным списком избранного: добавлять в него рецепты или удалять их, просматривать свою страницу избранных рецептов.
-   Работать с персональным списком покупок: добавлять/удалять **любые** рецепты, выгружать файл со количеством необходимых ингридиентов для рецептов из списка покупок.
-   Подписываться на публикации авторов рецептов и отменять подписку, просматривать свою страницу подписок.

#### Что может делать администратор

Администратор обладает всеми правами авторизованного пользователя.

Плюс к этому он может:

-   изменять пароль любого пользователя,
-   создавать/блокировать/удалять аккаунты пользователей,
-   редактировать/удалять **любые** рецепты,
-   добавлять/удалять/редактировать ингредиенты.
-   добавлять/удалять/редактировать теги.

Все эти функции нужно реализовать в стандартной админ-панели Django.

### Подготовка сервера для деплоя
1. Войдите на свой удаленный сервер в облаке.
2. Остановите службу nginx:
```
sudo systemctl stop nginx
```
3. Установите docker:

```
sudo apt install docker.io
```

4. Установите docker-compose, с этим вам поможет [официальная документация](https://docs.docker.com/compose/install/).

5. Скопируйте файлы _docker-compose.yaml_ и _nginx/default.conf_ из проекта на сервер в _home/<ваш_username>/docker-compose.yaml_ и _home/<ваш_username>/nginx/default.conf_ соответственно.

  Эти файлы всегда копируются вручную. Обычно они настраиваются один раз и изменения в них вносятся крайне редко.

6. Добавьте в Secrets GitHub Actions переменные окружения для работы базы данных и деплоя.
   

### «Закинь данные из csv в БД» — достаточно распространённая задача.

В проекте Foodgram реализован программный модуль автоматического наполнения баз данных!
Для это необходимо всего лишь поместить файлы по адресу ```/backend/data``` и ввести команду:
```sh
docker compose exec backend python manage.py load_data_from_csv
```
Для создания суперпользователя, используйте:
```sh
docker compose exec backend python manage.py createsuperuser
```
Соберите статические файлы в единое место (--no-input - без запроса параметров у пользователя):
```sh
docker-compose exec web python manage.py collectstatic --no-input

```
Для остановки работы контейнера, удаления его и томов используйте:

```sh
docker-compose down -v
```
### Актуальная информация по взаимодействию с эндпоинтами
Для быстрого ориентирования в системе эндпоинтов API в проекте подключена документация API! Воспользоваться ей можно пройдя по адресу:

```sh
http://http://fooodgram.sytes.net/api/docs/
```

  

В ней описаны возможные запросы к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос, права доступа и дополнительные параметры, если это необходимо.

   

### Автор

   

[**Николай Слесарев**](https://github.com/Kolanser)